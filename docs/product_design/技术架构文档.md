# 活动家智能连接平台 - 技术架构文档

## 1. 架构设计

```mermaid
graph TD
    A[微信浏览器] --> B[React Frontend Application]
    B --> C[Supabase SDK]
    C --> D[Supabase Service]
    B --> E[智能匹配API服务]
    
    subgraph "前端层"
        B
    end
    
    subgraph "服务层"
        D
        E
    end
    
    subgraph "数据层"
        F[PostgreSQL Database]
        G[文件存储]
    end
    
    D --> F
    D --> G
```

## 2. 技术描述

- 前端：React@18 + TypeScript@5 + Vite@5 + Tailwind CSS@3 + Ant Design Mobile@5
- 后端：Supabase (认证、数据库、文件存储)
- 外部服务：智能匹配API服务（NLP处理和匹配算法）

## 3. 路由定义

| 路由 | 用途 |
|------|------|
| /login | 登录页面，商家账号密码认证 |
| /dashboard | 管理后台首页，显示活动列表和创建入口 |
| /activities/create | 创建活动页面，填写活动基本信息 |
| /activities/:id | 活动详情页面，展示活动信息和管理入口 |
| /activities/:id/edit | 编辑活动页面，修改活动信息 |
| /activities/:id/enroll | 报名管理页面，导入和筛选参与者信息 |
| /activities/:id/match | 匹配配置页面，设置规则和查看分组结果 |

## 4. API定义

### 4.1 用户认证相关

#### 4.1.1 商家登录
```
POST /api/auth/login-password
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| identifier | string | true | 商家标识符 |
| password | string | true | 密码 |

请求示例：
```json
{
  "identifier": "org1",
  "password": "123456"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |
| token | string | 访问令牌 |
| user | object | 用户信息对象 |

用户信息对象（user）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 用户ID |
| phone | string | 手机号 |
| name | string | 姓名 |
| user_type | string | 用户类型 |
| age | integer | 年龄 |
| occupation | string | 职业 |
| company | string | 公司 |
| tags | array | 标签数组 |
| wechat_qr | string | 微信二维码 |

成功响应示例：
```json
{
  "success": true,
  "message": "登录成功",
  "token": "mock_token_1234567890",
  "user": {
    "id": "user_001",
    "phone": "13800138000",
    "name": "张三",
    "user_type": "merchant",
    "age": 30,
    "occupation": "产品经理",
    "company": "活动家科技有限公司",
    "tags": ["产品设计", "用户体验", "项目管理"],
    "wechat_qr": "https://example.com/wechat_qr.png"
  }
}
```

失败响应示例：
```json
{
  "success": false,
  "message": "用户名或密码错误",
  "token": "",
  "user": null
}
```

错误响应：
| 状态码 | 描述 |
|--------|------|
| 400 | 请求参数错误（缺少必填字段） |
| 401 | 用户名或密码错误 |
| 500 | 服务器内部错误 |

测试账号：
| 标识符 | 密码 | 描述 |
|--------|------|------|
| org1 | 123456 | 测试商家账号 |

#### 4.1.2 超管登录
```
POST /api/auth/login-password
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| identifier | string | true | 超管标识符 |
| password | string | true | 密码 |

请求示例：
```json
{
  "identifier": "admin1",
  "password": "123456"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |
| token | string | 访问令牌 |
| user | object | 用户信息对象 |

用户信息对象（user）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 用户ID |
| phone | string | 手机号 |
| name | string | 姓名 |
| user_type | string | 用户类型 |
| age | integer | 年龄 |
| occupation | string | 职业 |
| company | string | 公司 |
| tags | array | 标签数组 |
| wechat_qr | string | 微信二维码 |

成功响应示例：
```json
{
  "success": true,
  "message": "登录成功",
  "token": "mock_token_1234567890",
  "user": {
    "id": "admin_001",
    "phone": "13900139000",
    "name": "李四",
    "user_type": "admin",
    "age": 35,
    "occupation": "系统管理员",
    "company": "活动家科技有限公司",
    "tags": ["系统管理", "数据分析", "运营管理"],
    "wechat_qr": "https://example.com/admin_wechat_qr.png"
  }
}
```

失败响应示例：
```json
{
  "success": false,
  "message": "用户名或密码错误",
  "token": "",
  "user": null
}
```

错误响应：
| 状态码 | 描述 |
|--------|------|
| 400 | 请求参数错误（缺少必填字段） |
| 401 | 用户名或密码错误 |
| 500 | 服务器内部错误 |

测试账号：
| 标识符 | 密码 | 描述 |
|--------|------|------|
| admin1 | 123456 | 测试超管账号 |

#### 4.1.3 用户登录
```
POST /login-password
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| identifier | string | true | 用户标识符 |
| password | string | true | 密码 |

请求示例：
```json
{
  "identifier": "user1",
  "password": "123456"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |
| token | string | 访问令牌 |
| user | object | 用户信息对象 |

用户信息对象（user）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 用户ID |
| phone | string | 手机号 |
| name | string | 姓名 |
| user_type | string | 用户类型 |
| age | integer | 年龄 |
| occupation | string | 职业 |
| company | string | 公司 |
| tags | array | 标签数组 |
| wechat_qr | string | 微信二维码 |

成功响应示例：
```json
{
  "success": true,
  "message": "登录成功",
  "token": "mock_token_1234567890",
  "user": {
    "id": "user_001",
    "phone": "13700137000",
    "name": "王五",
    "user_type": "user",
    "age": 28,
    "occupation": "软件工程师",
    "company": "科技创新公司",
    "tags": ["技术开发", "创新思维", "团队协作"],
    "wechat_qr": "https://example.com/user_wechat_qr.png"
  }
}
```

失败响应示例：
```json
{
  "success": false,
  "message": "用户名或密码错误",
  "token": "",
  "user": null
}
```

错误响应：
| 状态码 | 描述 |
|--------|------|
| 400 | 请求参数错误（缺少必填字段） |
| 401 | 用户名或密码错误 |
| 500 | 服务器内部错误 |

测试账号：
| 标识符 | 密码 | 描述 |
|--------|------|------|
| user1 | 123456 | 测试用户账号 |

#### 4.1.4 用户注册
```
POST /register-account
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| account | string | true | 用户账号 |
| password | string | true | 密码 |

请求示例：
```json
{
  "account": "user7",
  "password": "123456"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |
| token | string | 访问令牌 |
| user | object | 用户信息对象 |

用户信息对象（user）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 用户ID |
| phone | null | 手机号（注册时为空） |
| name | string | 姓名 |
| user_type | string | 用户类型 |
| age | null | 年龄（注册时为空） |
| occupation | null | 职业（注册时为空） |
| company | null | 公司（注册时为空） |
| tags | array | 标签数组 |
| wechat_qr | null | 微信二维码（注册时为空） |

成功响应示例：
```json
{
  "success": true,
  "message": "注册成功",
  "token": "mock_token_1234567890",
  "user": {
    "id": "user_007",
    "phone": null,
    "name": "user7",
    "user_type": "user",
    "age": null,
    "occupation": null,
    "company": null,
    "tags": [],
    "wechat_qr": null
  }
}
```

失败响应示例：
```json
{
  "success": false,
  "message": "用户名已存在",
  "token": "",
  "user": null
}
```

错误响应：
| 状态码 | 描述 |
|--------|------|
| 400 | 请求参数错误（缺少必填字段） |
| 409 | 用户名已存在 |
| 500 | 服务器内部错误 |

测试账号：
| 账号 | 密码 | 描述 |
|------|------|------|
| user7 | 123456 | 测试注册账号 |

#### 4.1.5 获取个人信息API

接口信息：
- 接口路径：`GET /me`
- 接口描述：获取当前登录用户的个人信息
- 认证方式：Bearer Token

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token} |
| Content-Type | string | 是 | application/json |

请求示例：
```bash
curl -X GET "http://localhost:3006/me" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6ImZlMDFmZDExLTUxZGYtNDZiMy05ZTg4LTQzMzUwNGE0NmU4YiIsInBob25lIjoiMTM3MDAxMzcwMDMiLCJ1c2VyX3R5cGUiOiJzdXBlcl9hZG1pbiIsImlhdCI6MTc2MTAzNjY2MiwiZXhwIjoxNzYxNjQxNDYyfQ.bwjP5_bk-7Hz2j0jmXbz-k-Te9bejOcUFv7Me4icSXU" \
  -H "Content-Type: application/json"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| user | object | 用户信息对象 |

用户信息对象（user）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 用户ID |
| phone | string | 手机号 |
| name | string | 姓名 |
| user_type | string | 用户类型 |
| age | integer | 年龄 |
| occupation | string | 职业 |
| company | string | 公司 |
| tags | array | 标签数组 |
| wechat_qr | string | 微信二维码 |

成功响应示例：
```json
{
  "success": true,
  "user": {
    "id": "fe01fd11-51df-46b3-9e88-433504a46e8b",
    "phone": "13700137003",
    "name": "张三",
    "user_type": "user",
    "age": 28,
    "occupation": "软件工程师",
    "company": "科技有限公司",
    "tags": ["技术", "创新"],
    "wechat_qr": "https://example.com/wechat_qr.png"
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 禁止访问（权限不足） | `{"success": false, "message": "权限不足"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

#### 4.1.6 修改密码API

接口信息：
- 接口路径：`PUT /modify-password`
- 接口描述：修改当前登录用户的密码
- 认证方式：Bearer Token

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token} |
| Content-Type | string | 是 | application/json |

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| oldPassword | string | 是 | 旧密码 |
| newPassword | string | 是 | 新密码 |

请求示例：
```bash
curl -X PUT "http://localhost:3006/modify-password" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjcyNDA4ODNlLTJmN2EtNDhjYy04NDFhLTg3ZGFkNGE1YjMxMiIsInBob25lIjoiMTM4MDAxMzgwMDEiLCJ1c2VyX3R5cGUiOiJ1c2VyIiwiaWF0IjoxNzYxMDU5MzQwLCJleHAiOjE3NjE2NjQxNDB9.BEdtYx2PVwNhj_F7XpAmaUcVv6hR-0iM5GjUqgUSOLI" \
  -H "Content-Type: application/json" \
  -d '{
    "oldPassword": "12345678",
    "newPassword": "123456"
  }'
```

请求体示例：
```json
{
  "oldPassword": "12345678",
  "newPassword": "123456"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |

成功响应示例：
```json
{
  "success": true,
  "message": "密码修改成功"
}
```

失败响应示例：
```json
{
  "success": false,
  "message": "旧密码错误"
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误（缺少必填字段） | `{"success": false, "message": "请求参数错误"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 旧密码错误 | `{"success": false, "message": "旧密码错误"}` |
| 422 | 新密码格式不符合要求 | `{"success": false, "message": "新密码格式不符合要求"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

#### 4.1.7 获取所有活动API

接口信息：
- 接口路径：`GET /`
- 接口描述：获取所有活动列表，支持按状态筛选
- 认证方式：Bearer Token（可选）

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 否 | Bearer {token} |

查询参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| status | string | 否 | 活动状态筛选（如：draft, published, ended） |

请求示例：
```bash
# 获取所有活动
curl -X GET "http://localhost:3006/" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjcyNDA4ODNlLTJmN2EtNDhjYy04NDFhLTg3ZGFkNGE1YjMxMiIsInBob25lIjoiMTM4MDAxMzgwMDEiLCJ1c2VyX3R5cGUiOiJ1c2VyIiwiaWF0IjoxNzYxMDU5NDk4LCJleHAiOjE3NjE2NjQyOTh9.2yGWjWHtNsG9PdPwvop7xzALwwKmbCrhmue3ZWOqGlM"

# 按状态筛选活动
curl -X GET "http://localhost:3006/?status=draft" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjcyNDA4ODNlLTJmN2EtNDhjYy04NDFhLTg3ZGFkNGE1YjMxMiIsInBob25lIjoiMTM4MDAxMzgwMDEiLCJ1c2VyX3R5cGUiOiJ1c2VyIiwiaWF0IjoxNzYxMDU5NDk4LCJleHAiOjE3NjE2NjQyOTh9.2yGWjWHtNsG9PdPwvop7xzALwwKmbCrhmue3ZWOqGlM"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| data | array | 活动列表 |
| total | number | 总数量 |
| page | number | 当前页码 |
| limit | number | 每页数量 |

活动对象（data中的每个元素）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 活动ID |
| title | string | 活动标题 |
| description | string | 活动描述 |
| status | string | 活动状态 |
| cover_image_url | string | 封面图片URL |
| registration_start | string | 报名开始时间 |
| registration_end | string | 报名结束时间 |
| activity_start | string | 活动开始时间 |
| activity_end | string | 活动结束时间 |
| created_at | string | 创建时间 |
| updated_at | string | 更新时间 |

成功响应示例：
```json
{
  "success": true,
  "data": [
    {
      "id": "activity_001",
      "title": "技术分享会",
      "description": "前端技术分享交流活动",
      "status": "published",
      "cover_image_url": "https://example.com/cover1.jpg",
      "registration_start": "2024-01-01T00:00:00Z",
      "registration_end": "2024-01-15T23:59:59Z",
      "activity_start": "2024-01-20T14:00:00Z",
      "activity_end": "2024-01-20T18:00:00Z",
      "created_at": "2023-12-20T10:00:00Z",
      "updated_at": "2023-12-25T15:30:00Z"
    },
    {
      "id": "activity_002",
      "title": "产品设计工作坊",
      "description": "用户体验设计实战工作坊",
      "status": "draft",
      "cover_image_url": "https://example.com/cover2.jpg",
      "registration_start": "2024-02-01T00:00:00Z",
      "registration_end": "2024-02-10T23:59:59Z",
      "activity_start": "2024-02-15T09:00:00Z",
      "activity_end": "2024-02-15T17:00:00Z",
      "created_at": "2023-12-22T14:00:00Z",
      "updated_at": "2023-12-28T09:15:00Z"
    }
  ],
  "total": 2,
  "page": 1,
  "limit": 10
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误 | `{"success": false, "message": "无效的状态参数"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

#### 4.1.8 获取特定活动信息API

接口信息：
- 接口路径：`GET /detail/{activity_id}`
- 接口描述：获取特定活动的详细信息，包括报名统计数据
- 认证方式：Bearer Token（可选）

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 否 | Bearer {token} |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/detail/7ea8f4b1-8b70-4356-a39a-e43e81ed597b" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjcyNDA4ODNlLTJmN2EtNDhjYy04NDFhLTg3ZGFkNGE1YjMxMiIsInBob25lIjoiMTM4MDAxMzgwMDEiLCJ1c2VyX3R5cGUiOiJ1c2VyIiwiaWF0IjoxNzYxMDU5NDk4LCJleHAiOjE3NjE2NjQyOTh9.2yGWjWHtNsG9PdPwvop7xzALwwKmbCrhmue3ZWOqGlM"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| event | object | 活动详细信息对象 |

活动对象（event）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 活动ID |
| organizer_id | string | 组织者ID |
| title | string | 活动标题 |
| description | string | 活动描述 |
| cover_image | string | 封面图片URL |
| start_time | string | 活动开始时间 |
| end_time | string | 活动结束时间 |
| location | string | 活动地点 |
| max_participants | integer | 最大参与人数 |
| fee | integer | 活动费用 |
| tags | array | 活动标签数组 |
| checkin_password | null/string | 签到密码 |
| status | string | 活动状态 |
| created_at | string | 创建时间 |
| updated_at | string | 更新时间 |
| expectation | null/string | 期望描述 |
| registration_stats | object | 报名统计信息 |

报名统计对象（registration_stats）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| total | integer | 总报名人数 |
| approved | integer | 已通过人数 |
| pending | integer | 待审核人数 |
| rejected | integer | 已拒绝人数 |

成功响应示例：
```json
{
  "success": true,
  "event": {
    "id": "7ea8f4b1-8b70-4356-a39a-e43e81ed597b",
    "organizer_id": "org_001",
    "title": "前端技术分享会",
    "description": "探讨最新的前端技术趋势和实践经验",
    "cover_image": "https://example.com/cover.jpg",
    "start_time": "2024-01-20T14:00:00Z",
    "end_time": "2024-01-20T18:00:00Z",
    "location": "北京市朝阳区科技园",
    "max_participants": 100,
    "fee": 0,
    "tags": ["前端", "技术分享", "React"],
    "checkin_password": null,
    "status": "published",
    "created_at": "2023-12-20T10:00:00Z",
    "updated_at": "2023-12-25T15:30:00Z",
    "expectation": null,
    "registration_stats": {
      "total": 85,
      "approved": 75,
      "pending": 8,
      "rejected": 2
    }
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误 | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

#### 4.1.9 商家获取特定活动报名信息API

接口信息：
- 接口路径：`GET /participants/{activity_id}`
- 接口描述：商家获取自己创建的特定活动的所有报名用户信息
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家访问自己创建的活动

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/participants/7ea8f4b1-8b70-4356-a39a-e43e81ed597b" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| total | integer | 总报名人数 |
| participants | array | 报名用户列表 |

报名用户对象（participants中的每个元素）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| user_id | string | 用户ID |
| status | string | 报名状态（pending: 待审核, approved: 已通过, rejected: 已拒绝） |
| created_at | string | 报名时间 |
| updated_at | string | 状态更新时间 |

成功响应示例：
```json
{
  "success": true,
  "total": 15,
  "participants": [
    {
      "user_id": "user_001",
      "status": "approved",
      "created_at": "2024-01-15T10:30:00Z",
      "updated_at": "2024-01-16T09:15:00Z"
    },
    {
      "user_id": "user_002",
      "status": "pending",
      "created_at": "2024-01-15T14:20:00Z",
      "updated_at": "2024-01-15T14:20:00Z"
    },
    {
      "user_id": "user_003",
      "status": "rejected",
      "created_at": "2024-01-14T16:45:00Z",
      "updated_at": "2024-01-16T11:30:00Z"
    }
  ]
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误 | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限访问（非活动创建者） | `{"success": false, "message": "无权限访问此活动的报名信息"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

**注意事项**：
- 此接口仅限商家使用，用于查看自己创建的活动的报名情况
- 商家只能访问自己创建的活动的报名信息，无法查看其他商家的活动报名数据
- 返回的报名状态包括：pending（待审核）、approved（已通过）、rejected（已拒绝）

#### 4.1.10 商家创建活动API

接口信息：
- 接口路径：`POST /create-event`
- 接口描述：商家创建新的活动
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |
| Content-Type | string | 是 | application/json |

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| title | string | 是 | 活动标题 |
| description | string | 是 | 活动描述 |
| registration_deadline | string | 是 | 报名截止时间（格式：YYYY-MM-DD HH:mm:ss） |
| start_time | string | 是 | 活动开始时间（格式：YYYY-MM-DD HH:mm:ss） |
| end_time | string | 是 | 活动结束时间（格式：YYYY-MM-DD HH:mm:ss） |
| location | string | 是 | 活动地点 |

请求示例：
```bash
curl -X POST "http://localhost:3006/create-event" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "测试项目",
    "description": "用于测试的项目",
    "registration_deadline": "2025-12-20 18:00:00",
    "start_time": "2025-12-21 09:00:00",
    "end_time": "2025-12-21 17:00:00",
    "location": "Shanghai"
  }'
```

请求体示例：
```json
{
  "title": "测试项目",
  "description": "用于测试的项目",
  "registration_deadline": "2025-12-20 18:00:00",
  "start_time": "2025-12-21 09:00:00",
  "end_time": "2025-12-21 17:00:00",
  "location": "Shanghai"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |
| event | object | 创建的活动信息 |

活动对象（event）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 活动ID |
| organizer_id | string | 组织者ID |
| title | string | 活动标题 |
| description | string | 活动描述 |
| registration_deadline | string | 报名截止时间 |
| start_time | string | 活动开始时间 |
| end_time | string | 活动结束时间 |
| location | string | 活动地点 |
| status | string | 活动状态（默认为draft） |
| created_at | string | 创建时间 |

成功响应示例（201 Created）：
```json
{
  "success": true,
  "message": "活动创建成功",
  "event": {
    "id": "event_12345",
    "organizer_id": "525c4dd1-d460-4dd5-bf45-0b5984dda94e",
    "title": "测试项目",
    "description": "用于测试的项目",
    "registration_deadline": "2025-12-20T18:00:00Z",
    "start_time": "2025-12-21T09:00:00Z",
    "end_time": "2025-12-21T17:00:00Z",
    "location": "Shanghai",
    "status": "draft",
    "created_at": "2024-01-20T10:30:00Z"
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误（缺少必填字段） | `{"success": false, "message": "缺少必填字段：title"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非商家用户） | `{"success": false, "message": "仅限商家用户创建活动"}` |
| 422 | 验证失败（时间格式错误或逻辑错误） | `{"success": false, "message": "活动开始时间不能早于报名截止时间"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

**注意事项**：
- 此接口仅限商家使用，用于创建新的活动
- 时间格式必须为：YYYY-MM-DD HH:mm:ss
- 活动开始时间必须晚于报名截止时间
- 活动结束时间必须晚于活动开始时间
- 创建成功后活动状态默认为draft（草稿）

#### 4.1.11 商家修改活动API

接口信息：
- 接口路径：`PUT /edit-event/{activity_id}`
- 接口描述：商家修改自己创建的活动信息
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能修改自己创建的活动

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |
| Content-Type | string | 是 | application/json |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求参数（部分更新，所有字段均为可选）：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| title | string | 否 | 活动标题 |
| description | string | 否 | 活动描述 |
| expectation | string | 否 | 活动期望/要求 |
| start_time | string | 否 | 活动开始时间（格式：YYYY-MM-DD HH:mm:ss） |
| end_time | string | 否 | 活动结束时间（格式：YYYY-MM-DD HH:mm:ss） |
| location | string | 否 | 活动地点 |
| max_participants | integer | 否 | 最大参与人数 |
| fee | integer | 否 | 活动费用（分为单位） |
| tags | array | 否 | 活动标签数组 |
| checkin_password | string | 否 | 签到密码 |
| registration_deadline | string | 否 | 报名截止时间（格式：YYYY-MM-DD HH:mm:ss） |

请求示例：
```bash
curl -X PUT "http://localhost:3006/edit-event/2798b125-ae0c-4e3e-a7e4-4181467ef28a" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E" \
  -H "Content-Type: application/json" \
  -d '{
    "title": "测试活动-添加期望",
    "expectation": "测试"
  }'
```

请求体示例：
```json
{
  "title": "测试活动-添加期望",
  "expectation": "测试"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |
| event | object | 修改后的完整活动信息 |

活动对象（event）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 活动ID |
| organizer_id | string | 组织者ID |
| title | string | 活动标题 |
| description | string | 活动描述 |
| cover_image | string/null | 封面图片URL |
| start_time | string | 活动开始时间 |
| end_time | string | 活动结束时间 |
| location | string | 活动地点 |
| max_participants | integer | 最大参与人数 |
| fee | integer | 活动费用（分为单位） |
| tags | array | 活动标签数组 |
| checkin_password | string/null | 签到密码 |
| status | string | 活动状态 |
| created_at | string | 创建时间 |
| updated_at | string | 更新时间 |
| expectation | string/null | 活动期望/要求 |
| registration_deadline | string | 报名截止时间 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "活动修改成功",
  "event": {
    "id": "2798b125-ae0c-4e3e-a7e4-4181467ef28a",
    "organizer_id": "525c4dd1-d460-4dd5-bf45-0b5984dda94e",
    "title": "测试活动-添加期望",
    "description": "这是一个测试活动的描述",
    "cover_image": null,
    "start_time": "2025-12-21T09:00:00Z",
    "end_time": "2025-12-21T17:00:00Z",
    "location": "Shanghai",
    "max_participants": 50,
    "fee": 0,
    "tags": ["测试", "活动"],
    "checkin_password": null,
    "status": "draft",
    "created_at": "2024-01-20T10:30:00Z",
    "updated_at": "2024-01-20T15:45:00Z",
    "expectation": "测试",
    "registration_deadline": "2025-12-20T18:00:00Z"
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误（无效的活动ID格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限修改此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 422 | 验证失败（时间格式错误或逻辑错误） | `{"success": false, "message": "活动开始时间不能早于报名截止时间"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

**注意事项**：
- 此接口仅限商家使用，用于修改自己创建的活动
- 商家只能修改自己创建的活动，无法修改其他商家的活动
- 支持部分更新，只需传入需要修改的字段
- 时间格式必须为：YYYY-MM-DD HH:mm:ss
- 如果修改时间相关字段，需要确保时间逻辑正确
- 修改成功后会返回完整的活动信息，包括更新后的updated_at时间

#### 4.1.12 商家取消活动API

接口信息：
- 接口路径：`DELETE /delete-event/{activity_id}`
- 接口描述：商家取消/删除自己创建的活动
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能取消自己创建的活动

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X DELETE "http://localhost:3006/delete-event/2798b125-ae0c-4e3e-a7e4-4181467ef28a" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 响应消息 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "活动取消成功"
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误（无效的活动ID格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限取消此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 409 | 冲突（活动已开始或有报名者） | `{"success": false, "message": "活动已开始或有报名者，无法取消"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

**注意事项**：
- 此接口仅限商家使用，用于取消/删除自己创建的活动
- 商家只能取消自己创建的活动，无法取消其他商家的活动
- 已开始的活动或已有报名者的活动可能无法取消（根据业务规则）
- 取消成功后，活动将被标记为已取消或从系统中删除
- 此操作不可逆，请谨慎使用

#### 4.1.13 商家获取自己创建的活动API

接口信息：
- 接口路径：`GET /my-events`
- 接口描述：商家获取自己创建的所有活动列表
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能获取自己创建的活动

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

查询参数（可选）：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| page | integer | 否 | 页码，默认为1 |
| limit | integer | 否 | 每页数量，默认为10 |
| status | string | 否 | 活动状态筛选 |

请求示例：
```bash
curl -X GET "http://localhost:3006/my-events?page=1&limit=10" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| events | array | 活动列表数组 |
| pagination | object | 分页信息 |

活动对象（events数组中的每个元素）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| id | string | 活动ID |
| organizer_id | string | 组织者ID |
| title | string | 活动标题 |
| description | string | 活动描述 |
| cover_image | string | 封面图片URL |
| start_time | string | 活动开始时间 |
| end_time | string | 活动结束时间 |
| location | string | 活动地点 |
| max_participants | integer | 最大参与人数 |
| fee | integer | 活动费用（分为单位） |
| tags | array | 活动标签数组 |
| checkin_password | string | 签到密码 |
| status | string | 活动状态 |
| created_at | string | 创建时间 |
| updated_at | string | 更新时间 |
| expectation | string/null | 活动期望/要求 |
| registration_deadline | string | 报名截止时间 |
| registration_count | integer | 当前报名人数 |

分页对象（pagination）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| page | integer | 当前页码 |
| limit | integer | 每页数量 |
| total | integer | 总记录数 |
| totalPages | integer | 总页数 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "events": [
    {
      "id": "event_12345",
      "organizer_id": "525c4dd1-d460-4dd5-bf45-0b5984dda94e",
      "title": "测试活动",
      "description": "这是一个测试活动的描述",
      "cover_image": "https://example.com/cover.jpg",
      "start_time": "2025-12-21T09:00:00Z",
      "end_time": "2025-12-21T17:00:00Z",
      "location": "Shanghai",
      "max_participants": 50,
      "fee": 0,
      "tags": ["测试", "活动"],
      "checkin_password": "123456",
      "status": "published",
      "created_at": "2024-01-20T10:30:00Z",
      "updated_at": "2024-01-20T15:45:00Z",
      "expectation": null,
      "registration_deadline": "2025-12-20T18:00:00Z",
      "registration_count": 15
    },
    {
      "id": "event_67890",
      "organizer_id": "525c4dd1-d460-4dd5-bf45-0b5984dda94e",
      "title": "另一个测试活动",
      "description": "另一个测试活动的描述",
      "cover_image": "https://example.com/cover2.jpg",
      "start_time": "2025-12-25T14:00:00Z",
      "end_time": "2025-12-25T18:00:00Z",
      "location": "Beijing",
      "max_participants": 30,
      "fee": 5000,
      "tags": ["会议", "技术"],
      "checkin_password": "654321",
      "status": "draft",
      "created_at": "2024-01-21T09:15:00Z",
      "updated_at": "2024-01-21T09:15:00Z",
      "expectation": "需要有相关技术背景",
      "registration_deadline": "2025-12-24T12:00:00Z",
      "registration_count": 8
    }
  ],
  "pagination": {
    "page": 1,
    "limit": 10,
    "total": 2,
    "totalPages": 1
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 请求参数错误（无效的分页参数） | `{"success": false, "message": "无效的分页参数"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非商家用户） | `{"success": false, "message": "仅限商家用户访问"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

**注意事项**：
- 此接口仅限商家使用，用于获取自己创建的活动列表
- 商家只能查看自己创建的活动，无法查看其他商家的活动
- 支持分页查询，默认每页10条记录
- 可通过status参数筛选特定状态的活动
- 返回的活动包含报名人数统计（registration_count）
- 活动按创建时间倒序排列

#### 4.1.14 提取匹配规则API

接口信息：
- 接口路径：`GET /generate-match-rules/{activity_id}`
- 接口描述：基于活动的报名信息，自动提取和生成匹配规则
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能提取自己创建的活动的匹配规则

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/generate-match-rules/d1375b03-e2fe-418d-b096-9064eae0d1b9" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 操作消息 |
| rules | array | 匹配规则数组，每个元素为字符串 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "匹配规则提取成功",
  "rules": [
    "年龄相近的参与者优先匹配",
    "相同兴趣爱好的参与者优先匹配",
    "地理位置相近的参与者优先匹配",
    "技能互补的参与者优先匹配",
    "性格类型相似的参与者优先匹配"
  ]
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 参数错误（无效的activity_id格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限访问此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 422 | 业务逻辑错误（活动无报名信息等） | `{"success": false, "message": "活动暂无报名信息，无法生成匹配规则"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "服务器内部错误"}` |

**注意事项**：
- 此接口仅限商家使用，用于智能提取活动的匹配规则
- 商家只能提取自己创建的活动的匹配规则，无法访问其他商家的活动
- 该API会分析活动的报名信息，自动生成适合的匹配规则建议
- 匹配规则基于报名者的个人信息、兴趣爱好、技能等维度进行智能分析
- 如果活动暂无报名信息，将返回422错误
- 生成的规则为建议性质，商家可根据实际需要进行调整

#### 4.1.15 提取关键词并做词嵌入API

接口信息：
- 接口路径：`GET /do-match/{activity_id}`
- 接口描述：对活动报名者信息进行关键词提取和词嵌入处理，为智能匹配算法提供数据基础
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能处理自己创建的活动

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/do-match/d1375b03-e2fe-418d-b096-9064eae0d1b9" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 处理消息 |
| data | object | 处理结果数据 |

处理结果数据对象（data）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| processed_count | integer | 处理的报名者数量 |
| keywords_extracted | array | 提取的关键词列表 |
| embedding_status | string | 词嵌入处理状态 |
| processing_time | number | 处理耗时（秒） |
| model_version | string | 使用的AI模型版本 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "关键词提取和词嵌入处理完成",
  "data": {
    "processed_count": 25,
    "keywords_extracted": [
      "技术交流",
      "前端开发",
      "React",
      "Vue.js",
      "JavaScript",
      "团队协作",
      "创新思维",
      "学习分享",
      "职业发展",
      "网络编程"
    ],
    "embedding_status": "completed",
    "processing_time": 3.2,
    "model_version": "text-embedding-ada-002"
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 参数错误（无效的activity_id格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限访问此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 422 | 业务逻辑错误（活动无报名信息、数据不足等） | `{"success": false, "message": "活动报名信息不足，无法进行关键词提取"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "AI处理服务暂时不可用"}` |

**注意事项**：
- 此接口仅限商家使用，用于对活动报名者信息进行AI智能处理
- 商家只能处理自己创建的活动，无法访问其他商家的活动数据
- 该API会对报名者的个人简介、兴趣爱好、技能标签等文本信息进行关键词提取
- 提取的关键词会通过AI模型生成词嵌入向量，用于后续的智能匹配算法
- 处理过程可能需要一定时间，建议在报名截止后或匹配前调用
- 如果活动报名信息不足（少于5人或文本信息过少），将返回422错误
- 处理结果会缓存一定时间，重复调用会返回缓存结果以提高效率

#### 4.1.16 提取用户关键词条API

接口信息：
- 接口路径：`GET /extract-keywords/{activity_id}`
- 接口描述：从活动报名者的个人信息中提取关键词条，用于匹配分析和用户画像
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能提取自己创建的活动的用户关键词条

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/extract-keywords/d1375b03-e2fe-418d-b096-9064eae0d1b9" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 操作消息 |
| data | object | 提取结果数据 |

提取结果数据对象（data）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| total_users | integer | 总用户数量 |
| keywords | array | 关键词条列表 |
| categories | array | 关键词分类统计 |

关键词对象（keywords数组中的每个元素）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| keyword | string | 关键词条 |
| frequency | integer | 出现频次 |
| category | string | 词条分类（如：技能、兴趣、行业等） |
| users | array | 关联的用户ID列表 |
| weight | number | 权重分数（0-1之间） |

分类统计对象（categories数组中的每个元素）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| category | string | 分类名称 |
| count | integer | 该分类下的关键词数量 |
| percentage | number | 占总关键词的百分比 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "用户关键词条提取完成",
  "data": {
    "total_users": 32,
    "keywords": [
      {
        "keyword": "前端开发",
        "frequency": 15,
        "category": "技能",
        "users": ["user_001", "user_005", "user_012"],
        "weight": 0.85
      },
      {
        "keyword": "React",
        "frequency": 12,
        "category": "技术栈",
        "users": ["user_001", "user_003", "user_008"],
        "weight": 0.78
      },
      {
        "keyword": "团队协作",
        "frequency": 18,
        "category": "软技能",
        "users": ["user_002", "user_007", "user_015"],
        "weight": 0.92
      },
      {
        "keyword": "创业",
        "frequency": 8,
        "category": "兴趣",
        "users": ["user_004", "user_011"],
        "weight": 0.65
      },
      {
        "keyword": "产品设计",
        "frequency": 10,
        "category": "技能",
        "users": ["user_006", "user_013", "user_020"],
        "weight": 0.72
      }
    ],
    "categories": [
      {
        "category": "技能",
        "count": 25,
        "percentage": 35.2
      },
      {
        "category": "技术栈",
        "count": 18,
        "percentage": 25.4
      },
      {
        "category": "软技能",
        "count": 15,
        "percentage": 21.1
      },
      {
        "category": "兴趣",
        "count": 13,
        "percentage": 18.3
      }
    ]
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 参数错误（无效的activity_id格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限访问此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 422 | 业务逻辑错误（活动无报名信息等） | `{"success": false, "message": "活动报名信息不足，无法提取关键词条"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "关键词提取服务暂时不可用"}` |

**注意事项**：
- 此接口仅限商家使用，用于从活动报名者信息中提取有价值的关键词条
- 商家只能提取自己创建的活动的用户关键词条，无法访问其他商家的活动数据
- 该API会分析报名者的个人简介、技能标签、兴趣爱好、工作经历等文本信息
- 关键词条按照频次和权重进行排序，权重越高表示该词条越重要
- 支持多种分类维度：技能、技术栈、软技能、兴趣、行业、教育背景等
- 提取结果可用于用户画像分析、智能匹配推荐、活动优化建议等场景
- 如果活动报名信息不足（少于3人或文本信息过少），将返回422错误
- 关键词条会去重并合并同义词，提高数据质量和分析准确性

#### 4.1.17 获取词向量API

接口信息：
- 接口路径：`POST /get_embedding`
- 接口描述：获取指定词汇的词向量表示，用于语义相似度计算和智能匹配
- 认证方式：无需认证（内部AI服务接口）
- 服务端口：独立AI服务端口（如localhost:5000），与主应用服务分离

请求体参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| word | string | 是 | 需要获取词向量的词汇 |

请求示例：
```bash
curl -X POST "http://localhost:5000/get_embedding" \
  -H "Content-Type: application/json" \
  -d '{
    "word": "开朗"
  }'
```

请求体示例：
```json
{
  "word": "开朗"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| embedding | array | 词向量数组，包含浮点数值 |

成功响应示例（200 OK）：
```json
{
  "embedding": [
    0.12345,
    -0.67890,
    0.54321,
    0.98765,
    -0.13579,
    0.24681,
    -0.86420,
    0.75319,
    0.46802,
    -0.91357,
    0.68024,
    -0.35791,
    0.80246,
    -0.57913,
    0.31468,
    0.92580,
    -0.64713,
    0.18529,
    0.73604,
    -0.40817
  ]
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 参数错误（缺少word参数或格式错误） | `{"error": "缺少必需参数 'word'"}` |
| 404 | 词汇不存在（词汇不在词向量模型中） | `{"error": "词汇 '开朗' 不在词向量模型中"}` |
| 500 | 服务器内部错误（AI模型服务不可用） | `{"error": "AI词向量服务暂时不可用"}` |

**注意事项**：
- 此接口为内部AI服务接口，无需身份认证，仅供系统内部调用
- 接口运行在独立的AI服务端口（通常为5000端口），与主应用服务（3006端口）分离
- 返回的词向量为高维浮点数数组，通常包含100-300个维度
- 词向量可用于计算词汇间的语义相似度，支持智能匹配和推荐功能
- 如果输入的词汇不在预训练模型的词汇表中，将返回404错误
- 词向量的维度和精度取决于所使用的预训练模型（如Word2Vec、GloVe、FastText等）
- 建议对频繁查询的词汇进行缓存，以提高系统性能
- 该服务主要用于支持活动匹配、用户画像分析等AI功能

#### 4.1.18 计算词嵌入并保存到数据库API

接口信息：
- 接口路径：`GET /get-embedding/{activity_id}`
- 接口描述：计算活动报名者的词嵌入向量并保存到数据库，为后续智能匹配做准备
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能处理自己创建的活动

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/get-embedding/d1375b03-e2fe-418d-b096-9064eae0d1b9" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 处理消息 |
| data | object | 处理结果数据 |

处理结果数据对象（data）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| processed_users | integer | 处理的用户数量 |
| embeddings_saved | integer | 保存的词嵌入数量 |
| processing_time | number | 处理耗时（秒） |
| vector_dimension | integer | 词向量维度 |
| database_records | integer | 数据库记录数 |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "词嵌入计算完成并已保存到数据库",
  "data": {
    "processed_users": 28,
    "embeddings_saved": 156,
    "processing_time": 4.7,
    "vector_dimension": 256,
    "database_records": 156
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 参数错误（无效的activity_id格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限访问此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 422 | 业务逻辑错误（活动无报名信息等） | `{"success": false, "message": "活动报名信息不足，无法计算词嵌入"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "词嵌入计算服务暂时不可用"}` |

**注意事项**：
- 此接口仅限商家使用，用于计算和保存活动报名者的词嵌入向量
- 商家只能处理自己创建的活动，无法访问其他商家的活动数据
- 该API会调用AI服务计算报名者信息的词嵌入向量，并将结果保存到数据库
- 词嵌入向量用于后续的相似度计算和智能匹配算法
- 处理过程可能需要较长时间，建议在报名截止后统一执行
- 如果活动报名信息不足（少于5人），将返回422错误
- 重复调用会更新已存在的词嵌入数据，确保数据的时效性

#### 4.1.19 计算余弦相似度API

接口信息：
- 接口路径：`GET /calculate-similarity/{activity_id}`
- 接口描述：计算活动报名者之间的余弦相似度，生成匹配矩阵用于智能分组
- 认证方式：Bearer Token（必填，商家认证）
- 权限要求：仅限商家使用，只能计算自己创建的活动的相似度

请求头：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| Authorization | string | 是 | Bearer {token}（商家token） |

路径参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | 是 | 活动ID |

请求示例：
```bash
curl -X GET "http://localhost:3006/calculate-similarity/d1375b03-e2fe-418d-b096-9064eae0d1b9" \
  -H "Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6IjUyNWM0ZGQxLWQ0NjAtNGRkNS1iZjQ1LTBiNTk4NGRkYTk0ZSIsInBob25lIjoiMTM5MDAxMzkwMDIiLCJ1c2VyX3R5cGUiOiJvcmdhbml6ZXIiLCJpYXQiOjE3NjEwNjQwMDAsImV4cCI6MTc2MTY2ODgwMH0.73fCaMgxONXGxGQdzqSStnukN7Wf_JEiGG047Ebjr_E"
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| success | boolean | 请求是否成功 |
| message | string | 处理消息 |
| data | object | 相似度计算结果数据 |

相似度计算结果数据对象（data）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| similarity_matrix | array | 相似度矩阵（二维数组） |
| user_pairs | array | 用户配对信息列表 |
| average_similarity | number | 平均相似度分数 |
| calculation_time | number | 计算耗时（秒） |
| matrix_size | string | 矩阵规模（如"28x28"） |

用户配对对象（user_pairs数组中的每个元素）：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| user1_id | string | 用户1的ID |
| user2_id | string | 用户2的ID |
| similarity_score | number | 相似度分数（0-1之间） |
| match_level | string | 匹配等级（high/medium/low） |

成功响应示例（200 OK）：
```json
{
  "success": true,
  "message": "余弦相似度计算完成",
  "data": {
    "similarity_matrix": [
      [1.0, 0.85, 0.72, 0.63],
      [0.85, 1.0, 0.78, 0.69],
      [0.72, 0.78, 1.0, 0.81],
      [0.63, 0.69, 0.81, 1.0]
    ],
    "user_pairs": [
      {
        "user1_id": "user_001",
        "user2_id": "user_002",
        "similarity_score": 0.85,
        "match_level": "high"
      },
      {
        "user1_id": "user_002",
        "user2_id": "user_003",
        "similarity_score": 0.78,
        "match_level": "high"
      },
      {
        "user1_id": "user_003",
        "user2_id": "user_004",
        "similarity_score": 0.81,
        "match_level": "high"
      },
      {
        "user1_id": "user_001",
        "user2_id": "user_003",
        "similarity_score": 0.72,
        "match_level": "medium"
      }
    ],
    "average_similarity": 0.76,
    "calculation_time": 2.3,
    "matrix_size": "28x28"
  }
}
```

错误响应：
| 状态码 | 描述 | 响应示例 |
|--------|------|----------|
| 400 | 参数错误（无效的activity_id格式） | `{"success": false, "message": "无效的活动ID格式"}` |
| 401 | 未授权（token无效或过期） | `{"success": false, "message": "Token无效或已过期"}` |
| 403 | 无权限（非活动创建者） | `{"success": false, "message": "无权限访问此活动"}` |
| 404 | 活动不存在 | `{"success": false, "message": "活动不存在"}` |
| 422 | 业务逻辑错误（词嵌入数据不足等） | `{"success": false, "message": "词嵌入数据不足，请先执行词嵌入计算"}` |
| 500 | 服务器内部错误 | `{"success": false, "message": "相似度计算服务暂时不可用"}` |

**注意事项**：
- 此接口仅限商家使用，用于计算活动报名者之间的余弦相似度
- 商家只能计算自己创建的活动的相似度，无法访问其他商家的活动数据
- 该API基于已保存的词嵌入向量计算用户间的余弦相似度
- 相似度分数范围为0-1，分数越高表示用户越相似
- 匹配等级：high(≥0.7)、medium(0.5-0.7)、low(<0.5)
- 返回的相似度矩阵为对称矩阵，对角线元素为1.0
- 建议在词嵌入计算完成后调用此接口
- 计算结果可用于智能分组、推荐匹配等功能

### 4.2 活动管理相关

#### 4.2.1 获取活动列表
```
GET /rest/v1/activities
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| merchant_id | string | false | 商家ID，不传则获取当前用户的活动 |
| status | string | false | 活动状态筛选 |
| page | number | false | 页码，默认1 |
| limit | number | false | 每页数量，默认10 |

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| data | array | 活动列表 |
| total | number | 总数量 |
| page | number | 当前页码 |
| limit | number | 每页数量 |

#### 4.2.2 创建活动
```
POST /rest/v1/activities
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| title | string | true | 活动名称，≤40字符 |
| description | string | true | 活动简介，≤200字符 |
| cover_image_url | string | true | 封面图URL |
| registration_start | string | true | 报名开始时间，ISO格式 |
| registration_end | string | true | 报名结束时间，ISO格式 |
| activity_start | string | true | 活动开始时间，ISO格式 |
| activity_end | string | true | 活动结束时间，ISO格式 |
| location | string | true | 活动地点 |
| capacity | number | true | 人数上限，正整数 |
| is_paid | boolean | false | 是否收费，默认false |
| tags | array | false | 活动标签 |
| check_in_code | string | false | 打卡口令 |

#### 4.2.3 更新活动
```
PUT /rest/v1/activities/:id
```

#### 4.2.4 删除活动
```
DELETE /rest/v1/activities/:id
```

### 4.3 报名管理相关

#### 4.3.1 获取报名列表
```
GET /rest/v1/enrollments
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | true | 活动ID |
| status | string | false | 报名状态筛选 |
| gender | string | false | 性别筛选 |
| age_range | string | false | 年龄段筛选 |
| profession | string | false | 职业筛选 |
| tags | array | false | 标签筛选 |
| page | number | false | 页码 |
| limit | number | false | 每页数量 |

#### 4.3.2 批量导入报名信息
```
POST /rest/v1/enrollments/batch
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | true | 活动ID |
| enrollments | array | true | 报名信息数组 |
| field_mapping | object | true | 字段映射配置 |

请求示例：
```json
{
  "activity_id": "uuid",
  "field_mapping": {
    "姓名": "name",
    "性别": "gender",
    "年龄": "age_range",
    "职业": "profession",
    "联系方式": "contact",
    "城市": "city",
    "个人简介": "bio",
    "自定义标签": "custom_tags"
  },
  "enrollments": [
    {
      "姓名": "张三",
      "性别": "男",
      "年龄": "25-30",
      "职业": "软件工程师",
      "联系方式": "13800138000",
      "城市": "北京",
      "个人简介": "热爱技术的程序员",
      "自定义标签": "技术,创业"
    }
  ]
}
```

#### 4.3.3 更新报名状态
```
PUT /rest/v1/enrollments/:id
```

#### 4.3.4 批量发送通知
```
POST /rest/v1/notifications/batch
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | true | 活动ID |
| enrollment_ids | array | true | 报名ID数组 |
| type | string | true | 通知类型：approved/rejected/waitlist |
| title | string | true | 通知标题 |
| content | string | true | 通知内容 |

### 4.4 智能匹配相关

#### 4.4.1 生成匹配规则
```
POST /api/match/rules/generate
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | true | 活动ID |
| description | string | true | 自然语言描述 |

请求示例：
```json
{
  "activity_id": "uuid",
  "description": "尽量跨院校、跨行业，兴趣重合优先，男女比例均衡"
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| rules | array | 生成的规则列表 |

响应示例：
```json
{
  "rules": [
    {
      "name": "兴趣相似",
      "weight": 30,
      "type": "similarity",
      "field": "interests"
    },
    {
      "name": "行业互补",
      "weight": 20,
      "type": "diversity",
      "field": "profession"
    },
    {
      "name": "院校多样",
      "weight": 15,
      "type": "diversity",
      "field": "school"
    },
    {
      "name": "性别均衡",
      "weight": 20,
      "type": "balance",
      "field": "gender"
    },
    {
      "name": "历史回避",
      "weight": 15,
      "type": "avoidance",
      "field": "history"
    }
  ]
}
```

#### 4.4.2 执行匹配
```
POST /api/match/execute
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| activity_id | string | true | 活动ID |
| rules | array | true | 匹配规则数组 |
| constraints | object | true | 约束条件 |

请求示例：
```json
{
  "activity_id": "uuid",
  "rules": [
    {
      "name": "兴趣相似",
      "weight": 30,
      "type": "similarity",
      "field": "interests"
    }
  ],
  "constraints": {
    "min_group_size": 2,
    "max_group_size": 6,
    "gender_ratio": {
      "min_male_ratio": 0.3,
      "max_male_ratio": 0.7
    },
    "max_same_profession": 2,
    "blacklist": [],
    "whitelist": []
  }
}
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| task_id | string | 匹配任务ID |
| status | string | 任务状态：queued/processing/completed/failed |

#### 4.4.3 获取匹配结果
```
GET /api/match/results/:task_id
```

响应参数：
| 参数名 | 参数类型 | 描述 |
|--------|----------|------|
| task_id | string | 任务ID |
| status | string | 任务状态 |
| progress | number | 进度百分比 |
| groups | array | 分组结果 |
| unmatched | array | 未匹配的参与者 |

#### 4.4.4 发布匹配结果
```
POST /api/match/publish
```

请求参数：
| 参数名 | 参数类型 | 是否必填 | 描述 |
|--------|----------|----------|------|
| task_id | string | true | 匹配任务ID |
| notify_members | boolean | false | 是否立即通知成员 |

### 4.5 文件上传相关

#### 4.5.1 上传封面图
```
POST /storage/v1/object/covers
```

#### 4.5.2 上传报名数据文件
```
POST /storage/v1/object/enrollments
```

## 5. 服务架构图

```mermaid
graph TD
    A[客户端/前端] --> B[路由层]
    B --> C[组件层]
    C --> D[状态管理层]
    D --> E[API服务层]
    E --> F[Supabase客户端]
    E --> G[智能匹配服务]
    
    subgraph 前端应用
        B
        C
        D
        E
    end
    
    subgraph 外部服务
        F
        G
    end
```

## 6. 数据模型

### 6.1 数据模型定义

```mermaid
erDiagram
    MERCHANTS ||--o{ ACTIVITIES : creates
    MERCHANTS ||--o{ MATCH_TASKS : initiates
    MERCHANTS ||--o{ FILE_UPLOADS : uploads
    MERCHANTS ||--o{ NOTIFICATIONS : sends
    
    ACTIVITIES ||--o{ ENROLLMENTS : receives
    ACTIVITIES ||--o{ MATCH_TASKS : generates
    ACTIVITIES ||--o{ MATCH_GROUPS : contains
    ACTIVITIES ||--o{ MATCH_RESULTS : produces
    ACTIVITIES ||--o{ NOTIFICATIONS : triggers
    ACTIVITIES ||--o{ FILE_UPLOADS : relates
    
    MATCH_TASKS ||--o{ MATCH_GROUPS : creates
    MATCH_TASKS ||--o{ MATCH_RESULTS : generates
    
    MATCH_GROUPS ||--o{ MATCH_RESULTS : contains
    ENROLLMENTS ||--o{ MATCH_RESULTS : participates
    ENROLLMENTS ||--o{ NOTIFICATIONS : receives

    MERCHANTS {
        uuid id PK
        string email UK
        string password_hash
        string company_name
        string contact_person
        string phone
        string status
        timestamp created_at
        timestamp updated_at
    }
    
    ACTIVITIES {
        uuid id PK
        uuid merchant_id FK
        string title
        text description
        string cover_image_url
        timestamp registration_start
        timestamp registration_end
        timestamp activity_start
        timestamp activity_end
        string location
        integer capacity
        integer current_enrollment
        boolean is_paid
        decimal price
        text_array tags
        string check_in_code
        string status
        timestamp created_at
        timestamp updated_at
    }
    
    ENROLLMENTS {
        uuid id PK
        uuid activity_id FK
        string name
        string gender
        string age_range
        string profession
        string contact
        string city
        string school
        text_array interests
        text bio
        text_array custom_tags
        string status
        uuid import_batch_id
        timestamp created_at
        timestamp updated_at
    }
    
    MATCH_TASKS {
        uuid id PK
        uuid activity_id FK
        uuid merchant_id FK
        text description
        jsonb rules
        jsonb constraints
        string status
        integer progress
        text error_message
        timestamp created_at
        timestamp updated_at
    }
    
    MATCH_GROUPS {
        uuid id PK
        uuid task_id FK
        uuid activity_id FK
        string group_name
        integer group_number
        integer group_size
        decimal match_score
        boolean is_published
        timestamp created_at
    }
    
    MATCH_RESULTS {
        uuid id PK
        uuid task_id FK
        uuid group_id FK
        uuid enrollment_id FK
        uuid activity_id FK
        boolean is_matched
        text match_reason
        timestamp created_at
    }
    
    NOTIFICATIONS {
        uuid id PK
        uuid activity_id FK
        uuid enrollment_id FK
        uuid merchant_id FK
        string type
        string title
        text content
        string status
        timestamp sent_at
        text error_message
        timestamp created_at
    }
    
    FILE_UPLOADS {
        uuid id PK
        uuid merchant_id FK
        uuid activity_id FK
        string file_name
        text file_path
        bigint file_size
        string file_type
        string upload_type
        string status
        integer processed_records
        text error_message
        timestamp created_at
    }
```

### 6.2 数据定义语言

**商家表 (merchants)**
```sql
-- 创建表
CREATE TABLE merchants (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email VARCHAR(255) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    company_name VARCHAR(100) NOT NULL,
    contact_person VARCHAR(50),
    phone VARCHAR(20),
    status VARCHAR(20) DEFAULT 'active' CHECK (status IN ('active', 'inactive')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_merchants_email ON merchants(email);
CREATE INDEX idx_merchants_status ON merchants(status);

-- 权限设置
GRANT SELECT ON merchants TO anon;
GRANT ALL PRIVILEGES ON merchants TO authenticated;

-- 初始数据
INSERT INTO merchants (email, password_hash, company_name, contact_person, phone) VALUES
('admin@huodongjia.com', '$2b$10$encrypted_password_hash', '活动家平台', '管理员', '400-123-4567');
```

**活动表 (activities)**
```sql
-- 创建表
CREATE TABLE activities (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    merchant_id UUID NOT NULL,
    title VARCHAR(100) NOT NULL,
    description TEXT,
    cover_image_url TEXT,
    registration_start TIMESTAMP WITH TIME ZONE NOT NULL,
    registration_end TIMESTAMP WITH TIME ZONE NOT NULL,
    activity_start TIMESTAMP WITH TIME ZONE NOT NULL,
    activity_end TIMESTAMP WITH TIME ZONE NOT NULL,
    location VARCHAR(200) NOT NULL,
    capacity INTEGER NOT NULL CHECK (capacity > 0),
    current_enrollment INTEGER DEFAULT 0,
    is_paid BOOLEAN DEFAULT FALSE,
    price DECIMAL(10,2) DEFAULT 0.00,
    tags TEXT[],
    check_in_code VARCHAR(50),
    status VARCHAR(20) DEFAULT 'draft' CHECK (status IN ('draft', 'published', 'ongoing', 'completed', 'cancelled')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_activities_merchant_id ON activities(merchant_id);
CREATE INDEX idx_activities_status ON activities(status);
CREATE INDEX idx_activities_registration_start ON activities(registration_start);
CREATE INDEX idx_activities_activity_start ON activities(activity_start);
CREATE INDEX idx_activities_tags ON activities USING GIN(tags);

-- 权限设置
GRANT SELECT ON activities TO anon;
GRANT ALL PRIVILEGES ON activities TO authenticated;

-- 初始数据
INSERT INTO activities (merchant_id, title, description, location, capacity, registration_start, registration_end, activity_start, activity_end) VALUES
((SELECT id FROM merchants LIMIT 1), '技术交流沙龙', '面向技术从业者的交流活动', '北京市朝阳区', 50, NOW(), NOW() + INTERVAL '7 days', NOW() + INTERVAL '14 days', NOW() + INTERVAL '14 days' + INTERVAL '3 hours');
```

**报名表 (enrollments)**
```sql
-- 创建表
CREATE TABLE enrollments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    activity_id UUID NOT NULL,
    name VARCHAR(50) NOT NULL,
    gender VARCHAR(10) CHECK (gender IN ('男', '女', '其他')),
    age_range VARCHAR(20) CHECK (age_range IN ('18-25', '25-30', '30-35', '35-40', '40+')),
    profession VARCHAR(100),
    contact VARCHAR(100) NOT NULL,
    city VARCHAR(50),
    school VARCHAR(100),
    interests TEXT[],
    bio TEXT,
    custom_tags TEXT[],
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'approved', 'rejected', 'waitlist')),
    import_batch_id UUID,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_enrollments_activity_id ON enrollments(activity_id);
CREATE INDEX idx_enrollments_status ON enrollments(status);
CREATE INDEX idx_enrollments_gender ON enrollments(gender);
CREATE INDEX idx_enrollments_age_range ON enrollments(age_range);
CREATE INDEX idx_enrollments_profession ON enrollments(profession);
CREATE INDEX idx_enrollments_city ON enrollments(city);
CREATE INDEX idx_enrollments_school ON enrollments(school);
CREATE INDEX idx_enrollments_interests ON enrollments USING GIN(interests);
CREATE INDEX idx_enrollments_custom_tags ON enrollments USING GIN(custom_tags);
CREATE INDEX idx_enrollments_import_batch ON enrollments(import_batch_id);

-- 权限设置
GRANT SELECT ON enrollments TO anon;
GRANT ALL PRIVILEGES ON enrollments TO authenticated;

-- 初始数据
INSERT INTO enrollments (activity_id, name, gender, age_range, profession, contact, city, school, interests, bio, custom_tags) VALUES
((SELECT id FROM activities LIMIT 1), '张三', '男', '25-30', '软件工程师', '13800138000', '北京', '清华大学', ARRAY['编程', '人工智能'], '热爱技术的程序员', ARRAY['技术', '创业']);
```

**匹配任务表 (match_tasks)**
```sql
-- 创建表
CREATE TABLE match_tasks (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    activity_id UUID NOT NULL,
    merchant_id UUID NOT NULL,
    description TEXT,
    rules JSONB NOT NULL,
    constraints JSONB NOT NULL,
    status VARCHAR(20) DEFAULT 'queued' CHECK (status IN ('queued', 'processing', 'completed', 'failed')),
    progress INTEGER DEFAULT 0 CHECK (progress >= 0 AND progress <= 100),
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_match_tasks_activity_id ON match_tasks(activity_id);
CREATE INDEX idx_match_tasks_merchant_id ON match_tasks(merchant_id);
CREATE INDEX idx_match_tasks_status ON match_tasks(status);
CREATE INDEX idx_match_tasks_created_at ON match_tasks(created_at DESC);

-- 权限设置
GRANT SELECT ON match_tasks TO anon;
GRANT ALL PRIVILEGES ON match_tasks TO authenticated;
```

**匹配分组表 (match_groups)**
```sql
-- 创建表
CREATE TABLE match_groups (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL,
    activity_id UUID NOT NULL,
    group_name VARCHAR(100),
    group_number INTEGER NOT NULL,
    group_size INTEGER NOT NULL,
    match_score DECIMAL(5,2),
    is_published BOOLEAN DEFAULT FALSE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_match_groups_task_id ON match_groups(task_id);
CREATE INDEX idx_match_groups_activity_id ON match_groups(activity_id);
CREATE INDEX idx_match_groups_is_published ON match_groups(is_published);
CREATE INDEX idx_match_groups_match_score ON match_groups(match_score DESC);

-- 权限设置
GRANT SELECT ON match_groups TO anon;
GRANT ALL PRIVILEGES ON match_groups TO authenticated;
```

**匹配结果表 (match_results)**
```sql
-- 创建表
CREATE TABLE match_results (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    task_id UUID NOT NULL,
    group_id UUID NOT NULL,
    enrollment_id UUID NOT NULL,
    activity_id UUID NOT NULL,
    is_matched BOOLEAN DEFAULT TRUE,
    match_reason TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_match_results_task_id ON match_results(task_id);
CREATE INDEX idx_match_results_group_id ON match_results(group_id);
CREATE INDEX idx_match_results_enrollment_id ON match_results(enrollment_id);
CREATE INDEX idx_match_results_activity_id ON match_results(activity_id);
CREATE INDEX idx_match_results_is_matched ON match_results(is_matched);

-- 权限设置
GRANT SELECT ON match_results TO anon;
GRANT ALL PRIVILEGES ON match_results TO authenticated;

-- 唯一约束：每个任务中每个报名者只能属于一个分组
CREATE UNIQUE INDEX idx_match_results_unique_enrollment_task ON match_results(task_id, enrollment_id);
```

**通知表 (notifications)**
```sql
-- 创建表
CREATE TABLE notifications (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    activity_id UUID NOT NULL,
    enrollment_id UUID,
    merchant_id UUID NOT NULL,
    type VARCHAR(20) NOT NULL CHECK (type IN ('approved', 'rejected', 'waitlist', 'match_result', 'activity_update', 'reminder')),
    title VARCHAR(200) NOT NULL,
    content TEXT NOT NULL,
    status VARCHAR(20) DEFAULT 'pending' CHECK (status IN ('pending', 'sent', 'failed')),
    sent_at TIMESTAMP WITH TIME ZONE,
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_notifications_activity_id ON notifications(activity_id);
CREATE INDEX idx_notifications_enrollment_id ON notifications(enrollment_id);
CREATE INDEX idx_notifications_merchant_id ON notifications(merchant_id);
CREATE INDEX idx_notifications_type ON notifications(type);
CREATE INDEX idx_notifications_status ON notifications(status);
CREATE INDEX idx_notifications_created_at ON notifications(created_at DESC);

-- 权限设置
GRANT SELECT ON notifications TO anon;
GRANT ALL PRIVILEGES ON notifications TO authenticated;
```

**文件上传记录表 (file_uploads)**
```sql
-- 创建表
CREATE TABLE file_uploads (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    merchant_id UUID NOT NULL,
    activity_id UUID,
    file_name VARCHAR(255) NOT NULL,
    file_path TEXT NOT NULL,
    file_size BIGINT NOT NULL,
    file_type VARCHAR(100) NOT NULL,
    upload_type VARCHAR(50) NOT NULL CHECK (upload_type IN ('cover_image', 'enrollment_data', 'other')),
    status VARCHAR(20) DEFAULT 'uploaded' CHECK (status IN ('uploaded', 'processing', 'processed', 'failed')),
    processed_records INTEGER DEFAULT 0,
    error_message TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- 创建索引
CREATE INDEX idx_file_uploads_merchant_id ON file_uploads(merchant_id);
CREATE INDEX idx_file_uploads_activity_id ON file_uploads(activity_id);
CREATE INDEX idx_file_uploads_upload_type ON file_uploads(upload_type);
CREATE INDEX idx_file_uploads_status ON file_uploads(status);
CREATE INDEX idx_file_uploads_created_at ON file_uploads(created_at DESC);

-- 权限设置
GRANT SELECT ON file_uploads TO anon;
GRANT ALL PRIVILEGES ON file_uploads TO authenticated;
```